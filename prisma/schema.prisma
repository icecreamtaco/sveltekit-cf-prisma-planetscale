generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = "prisma://aws-us-east-1.prisma-data.com/?api_key=rsw-6iQQGBCy-PxiipJa3UARRu8BCd7Fa_A2oImPyBfobsqyKSfPVuc7wjOjTWt1"
  referentialIntegrity = "prisma"
}

model user {
  id         String @id
  stxAddress String @unique
  roleId     Int

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  role role @relation(fields: [roleId], references: [id])


  session session[]

  Sender            notification[]      @relation("Sender")
  Recipient         notification[]      @relation("Recipient")
  userProjectFollow userProjectFollow[]
  comment           comment[]
  projectMember     projectMember[]
  answer            answer[]
  project           project[]
}

model role {
  id               Int                @id @unique @default(autoincrement())
  name             String
  createdAt        DateTime           @default(now())
  notificationType notificationType[]
  user             user[]
}

model notificationType {
  id        Int      @id @unique @default(autoincrement())
  name      String
  roleId    Int
  template  String
  createdAt DateTime @default(now())

  role role @relation(fields: [roleId], references: [id])


  notification notification[]
}

model notification {
  id          Int      @id @unique @default(autoincrement())
  typeId      Int
  projectId   Int
  senderId    String
  recipientId String
  message     String
  isRead      Boolean
  createdAt   DateTime @default(now())

  sender    user @relation("Sender", fields: [senderId], references: [id])
  recipient user @relation("Recipient", fields: [recipientId], references: [id])

  type    notificationType @relation(fields: [typeId], references: [id])
  project project          @relation(fields: [projectId], references: [id])


  @@index([projectId])
  @@index([recipientId])
}

model session {
  id               Int      @id @unique @default(autoincrement())
  userId           String
  refreshTokenHash String?
  device           String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now())

  user user @relation(fields: [userId], references: [id])

  @@unique([userId, device])
}

model userProjectFollow {
  id Int @id @unique @default(autoincrement())

  userId    String
  projectId Int
  createdAt DateTime @default(now())

  user    user    @relation(fields: [userId], references: [id])
  project project @relation(fields: [projectId], references: [id])


  @@unique([userId, projectId])
}

model project {
  id        Int      @id @unique @default(autoincrement())
  title     String
  userId    String
  typeId    Int
  statusId  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  user              user                @relation(fields: [userId], references: [id])
  userProjectFollow userProjectFollow[]
  payment           payment[]

  type   projectType   @relation(fields: [typeId], references: [id])
  status projectStatus @relation(fields: [statusId], references: [id])

  projectMember projectMember[]
  answer        answer[]
  notification  notification[]
  comment       comment[]

}

model payment {
  id        Int @id @unique @default(autoincrement())
  projectId Int
  typeId    Int

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  project project     @relation(fields: [projectId], references: [id])
  type    paymentType @relation(fields: [typeId], references: [id])
}

model paymentType {
  id        Int      @id @unique @default(autoincrement())
  name      String
  createdAt DateTime @default(now())

  payment payment[]
}

model projectStatus {
  id          Int       @id @unique @default(autoincrement())
  name        String
  description String
  createdAt   DateTime  @default(now())
  project     project[]
}

model projectType {
  id   Int    @id @unique @default(autoincrement())
  name String

  createdAt DateTime  @default(now())
  project   project[]
}

model comment {
  id        Int      @id @unique @default(autoincrement())
  userId    String
  text      String
  projectId Int
  createdAt DateTime @default(now())

  user    user    @relation(fields: [userId], references: [id])
  project project @relation(fields: [projectId], references: [id])

  @@index([projectId])
}

model projectMember {
  id        Int      @id @unique @default(autoincrement())
  userId    String
  projectId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  user    user    @relation(fields: [userId], references: [id])
  project project @relation(fields: [projectId], references: [id])


  @@unique([userId, projectId])
}

model question {
  id   Int    @id @unique @default(autoincrement())
  name String
  text String

  createdAt DateTime @default(now())
  answer    answer[]
}

model answer {
  id Int @id @unique @default(autoincrement())

  userId     String
  projectId  Int
  questionId Int
  answer     String
  createdAt  DateTime @default(now())

  user     user     @relation(fields: [userId], references: [id])
  project  project  @relation(fields: [projectId], references: [id])
  question question @relation(fields: [questionId], references: [id])

  @@index([userId])
  @@index([projectId])
}
